<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Accountability App</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
        'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
        sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    #root {
      width: 100%;
      max-width: 1600px;
      margin: 0 auto;
    }

    .app {
      width: 100%;
    }

    .app-header {
      text-align: center;
      color: white;
      margin-bottom: 30px;
    }

    .app-header h1 {
      font-size: 2.8rem;
      font-weight: 700;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
    }

    .app-header .date {
      font-size: 1.2rem;
      opacity: 0.9;
    }

    /* Quote Section */
    .quote-section {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 25px 40px;
      margin-bottom: 30px;
      text-align: center;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .quote-text {
      font-size: 1.3rem;
      color: white;
      font-style: italic;
      line-height: 1.6;
      margin-bottom: 12px;
    }

    .quote-author {
      font-size: 1rem;
      color: rgba(255, 255, 255, 0.8);
      font-weight: 500;
    }

    .app-content {
      display: grid;
      grid-template-columns: 1fr 1.5fr;
      gap: 25px;
    }

    @media (max-width: 1200px) {
      .app-content {
        grid-template-columns: 1fr;
      }
    }

    .left-panel {
      display: flex;
      flex-direction: column;
      gap: 25px;
    }

    .progress-section {
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 25px;
    }

    .progress-stats {
      display: flex;
      gap: 40px;
      width: 100%;
      justify-content: center;
    }

    .stat {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }

    .stat-value {
      font-size: 2.2rem;
      font-weight: 700;
      color: #667eea;
    }

    .stat-label {
      font-size: 0.85rem;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .right-panel {
      display: flex;
      flex-direction: column;
      gap: 25px;
    }

    .panel-card {
      background: white;
      border-radius: 20px;
      padding: 25px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
    }

    .progress-circle-container {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .progress-circle {
      transform: rotate(-90deg);
    }

    .progress-circle-bg {
      stroke: #e0e0e0;
    }

    .progress-circle-fill {
      stroke: #667eea;
      stroke-linecap: round;
      transition: stroke-dashoffset 0.5s ease;
    }

    .progress-circle-text {
      position: absolute;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .progress-percentage {
      font-size: 2.5rem;
      font-weight: 700;
      color: #667eea;
      line-height: 1;
    }

    .progress-label {
      font-size: 0.9rem;
      color: #666;
      margin-top: 5px;
    }

    .habit-list {
      background: white;
      border-radius: 20px;
      padding: 25px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
    }

    .habit-list-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .habit-list-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: #333;
    }

    .add-habit-btn {
      background: #667eea;
      color: white;
      border: none;
      padding: 10px 18px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 600;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .add-habit-btn:hover {
      background: #5568d3;
      transform: scale(1.05);
    }

    .add-habit-form {
      display: none;
      background: #f8f9ff;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      border: 2px solid #667eea30;
    }

    .add-habit-form.visible {
      display: block;
    }

    .form-row {
      display: flex;
      gap: 12px;
      margin-bottom: 12px;
    }

    .form-input {
      flex: 1;
      padding: 12px 14px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 1rem;
      font-family: inherit;
      transition: all 0.3s ease;
    }

    .form-input:focus {
      outline: none;
      border-color: #667eea;
    }

    .form-input.emoji-input {
      width: 80px;
      flex: none;
      text-align: center;
      font-size: 1.5rem;
    }

    .form-checkbox {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9rem;
      color: #666;
    }

    .form-actions {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .btn {
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
    }

    .btn-primary {
      background: #667eea;
      color: white;
    }

    .btn-primary:hover {
      background: #5568d3;
    }

    .btn-secondary {
      background: #e0e0e0;
      color: #666;
    }

    .btn-secondary:hover {
      background: #d0d0d0;
    }

    .habits-container {
      display: flex;
      flex-direction: column;
      gap: 12px;
      max-height: 450px;
      overflow-y: auto;
    }

    .habit-wrapper {
      display: flex;
      flex-direction: column;
    }

    .habit-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      background: #fafafa;
    }

    .habit-item:hover {
      border-color: #667eea;
      background: #f0f0ff;
    }

    .habit-item.completed {
      background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
      border-color: #667eea;
    }

    .habit-checkbox {
      width: 26px;
      height: 26px;
      border: 3px solid #667eea;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      background: white;
      transition: all 0.3s ease;
    }

    .habit-item.completed .habit-checkbox {
      background: #667eea;
      border-color: #667eea;
    }

    .checkmark {
      width: 16px;
      height: 16px;
      color: white;
    }

    .habit-content {
      display: flex;
      align-items: center;
      gap: 10px;
      flex: 1;
    }

    .habit-emoji {
      font-size: 1.5rem;
    }

    .habit-label {
      font-size: 1rem;
      font-weight: 500;
      color: #333;
      transition: all 0.3s ease;
    }

    .habit-item.completed .habit-label {
      color: #667eea;
      text-decoration: line-through;
      opacity: 0.7;
    }

    .habit-actions {
      display: flex;
      gap: 8px;
    }

    .expand-btn, .delete-btn {
      background: #667eea;
      color: white;
      border: none;
      width: 28px;
      height: 28px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 700;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .expand-btn:hover {
      background: #5568d3;
    }

    .delete-btn {
      background: #ff6b6b;
      font-size: 0.8rem;
    }

    .delete-btn:hover {
      background: #ee5a5a;
    }

    .expand-btn.expanded {
      background: #764ba2;
    }

    .dropdown-section {
      margin-top: 10px;
      padding: 16px;
      background: #f8f9ff;
      border-radius: 10px;
      border: 2px solid #667eea30;
      display: none;
    }

    .dropdown-section.expanded {
      display: block;
    }

    .input-group {
      margin-bottom: 10px;
    }

    .input-group:last-child {
      margin-bottom: 0;
    }

    .input-group label {
      display: block;
      font-size: 0.8rem;
      color: #666;
      margin-bottom: 4px;
      font-weight: 500;
    }

    .input-field {
      width: 100%;
      padding: 10px 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 0.95rem;
      font-family: inherit;
      transition: all 0.3s ease;
      background: white;
    }

    .input-field:focus {
      outline: none;
      border-color: #667eea;
    }

    .input-field.filled {
      border-color: #667eea;
      background: linear-gradient(135deg, #667eea08 0%, #764ba208 100%);
    }

    .dropdown-title {
      font-size: 0.95rem;
      font-weight: 600;
      color: #667eea;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .filled-count {
      background: #667eea;
      color: white;
      font-size: 0.75rem;
      padding: 2px 8px;
      border-radius: 10px;
      margin-left: auto;
    }

    /* Calendar Styles */
    .calendar-section {
      width: 100%;
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .calendar-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: #333;
    }

    .calendar-nav {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .calendar-nav-btn {
      background: #667eea;
      color: white;
      border: none;
      width: 36px;
      height: 36px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1.2rem;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .calendar-nav-btn:hover {
      background: #5568d3;
    }

    .calendar-month-year {
      font-size: 1.1rem;
      font-weight: 600;
      color: #333;
      min-width: 150px;
      text-align: center;
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
    }

    .calendar-day-header {
      text-align: center;
      font-size: 0.85rem;
      font-weight: 600;
      color: #666;
      padding: 8px;
    }

    .calendar-day {
      aspect-ratio: 1;
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      border: 2px solid transparent;
    }

    .calendar-day.empty {
      background: transparent;
      cursor: default;
    }

    .calendar-day:not(.empty):hover {
      transform: scale(1.05);
      border-color: #667eea;
    }

    .calendar-day.today {
      border: 3px solid #667eea;
      font-weight: 700;
    }

    .calendar-day .day-number {
      font-size: 0.9rem;
      margin-bottom: 4px;
    }

    .calendar-day .day-progress {
      font-size: 0.7rem;
      color: #666;
    }

    .calendar-day.level-0 { background: #f0f0f0; }
    .calendar-day.level-1 { background: #c7d2fe; }
    .calendar-day.level-2 { background: #a5b4fc; }
    .calendar-day.level-3 { background: #818cf8; color: white; }
    .calendar-day.level-4 { background: #667eea; color: white; }
    .calendar-day.level-5 { background: #4f46e5; color: white; }

    .calendar-day.level-3 .day-progress,
    .calendar-day.level-4 .day-progress,
    .calendar-day.level-5 .day-progress {
      color: rgba(255, 255, 255, 0.8);
    }

    /* Rest Day & Weekend Styles */
    .rest-day-message {
      text-align: center;
      padding: 50px 20px;
    }

    .rest-emoji {
      font-size: 5rem;
      margin-bottom: 20px;
    }

    .rest-day-message h3 {
      font-size: 1.8rem;
      color: #667eea;
      margin-bottom: 12px;
      font-weight: 700;
    }

    .rest-day-message p {
      color: #666;
      font-size: 1.1rem;
      margin-bottom: 8px;
    }

    .rest-subtext {
      font-size: 1rem !important;
      color: #888 !important;
      font-style: italic;
    }

    .weekend-notice {
      background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
      border: 2px solid #667eea30;
      border-radius: 12px;
      padding: 14px 18px;
      margin-bottom: 20px;
      text-align: center;
      font-size: 0.95rem;
      color: #667eea;
      font-weight: 500;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .calendar-legend {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
      margin-top: 20px;
      font-size: 0.8rem;
      color: #666;
    }

    .legend-item {
      width: 20px;
      height: 20px;
      border-radius: 4px;
    }

    /* Stats Row */
    .stats-row {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin-bottom: 20px;
    }

    .stat-card {
      background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
      border-radius: 12px;
      padding: 15px;
      text-align: center;
      border: 2px solid #667eea20;
    }

    .stat-card-value {
      font-size: 1.8rem;
      font-weight: 700;
      color: #667eea;
    }

    .stat-card-label {
      font-size: 0.8rem;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-top: 4px;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script>
    // Motivational Quotes
    const QUOTES = [
      { text: "The secret of getting ahead is getting started.", author: "Mark Twain" },
      { text: "It's not about perfect. It's about effort.", author: "Jillian Michaels" },
      { text: "Small daily improvements are the key to staggering long-term results.", author: "Robin Sharma" },
      { text: "Success is the sum of small efforts repeated day in and day out.", author: "Robert Collier" },
      { text: "The only way to do great work is to love what you do.", author: "Steve Jobs" },
      { text: "Believe you can and you're halfway there.", author: "Theodore Roosevelt" },
      { text: "Your limitation‚Äîit's only your imagination.", author: "Unknown" },
      { text: "Push yourself, because no one else is going to do it for you.", author: "Unknown" },
      { text: "Great things never come from comfort zones.", author: "Unknown" },
      { text: "Dream it. Wish it. Do it.", author: "Unknown" },
      { text: "Stay focused and never give up.", author: "Unknown" },
      { text: "The harder you work, the luckier you get.", author: "Gary Player" },
      { text: "Don't watch the clock; do what it does. Keep going.", author: "Sam Levenson" },
      { text: "Everything you've ever wanted is on the other side of fear.", author: "George Addair" },
      { text: "Success doesn't come from what you do occasionally, it comes from what you do consistently.", author: "Marie Forleo" },
      { text: "The difference between who you are and who you want to be is what you do.", author: "Unknown" },
      { text: "A year from now you may wish you had started today.", author: "Karen Lamb" },
      { text: "Do something today that your future self will thank you for.", author: "Sean Patrick Flanery" },
      { text: "Little by little, one travels far.", author: "J.R.R. Tolkien" },
      { text: "You don't have to be great to start, but you have to start to be great.", author: "Zig Ziglar" },
      { text: "The best time to plant a tree was 20 years ago. The second best time is now.", author: "Chinese Proverb" },
      { text: "Your future is created by what you do today, not tomorrow.", author: "Robert Kiyosaki" },
      { text: "Discipline is the bridge between goals and accomplishment.", author: "Jim Rohn" },
      { text: "Winners are not people who never fail, but people who never quit.", author: "Unknown" },
      { text: "The only bad workout is the one that didn't happen.", author: "Unknown" },
      { text: "Progress, not perfection.", author: "Unknown" },
      { text: "Make each day your masterpiece.", author: "John Wooden" },
      { text: "Be stronger than your excuses.", author: "Unknown" },
      { text: "What you do today can improve all your tomorrows.", author: "Ralph Marston" },
      { text: "Strive for progress, not perfection.", author: "Unknown" },
      { text: "The journey of a thousand miles begins with a single step.", author: "Lao Tzu" }
    ];

    // Default habits
    const DEFAULT_HABITS = [
      { id: 'read', label: 'Read 50 pages', emoji: 'üìö', isDefault: true },
      { id: 'meditate', label: 'Meditate', emoji: 'üßò', isDefault: true },
      { id: 'writeIdeas', label: 'Write 5 ideas', emoji: 'üí°', hasDropdown: true, dropdownTitle: 'Your Ideas', inputLabel: 'Idea', isDefault: true },
      { id: 'todoList', label: '5 to-do list items', emoji: '‚úÖ', hasDropdown: true, dropdownTitle: 'Your To-Do List', inputLabel: 'To-Do', isDefault: true },
      { id: 'affirmations', label: '5 affirmations', emoji: '‚ú®', hasDropdown: true, dropdownTitle: 'Your Affirmations', inputLabel: 'Affirmation', isDefault: true },
      { id: 'exercise', label: 'Exercise', emoji: 'üí™', isDefault: true },
      { id: 'eatHealthy', label: 'Eat healthy', emoji: 'ü•ó', isDefault: true },
    ];

    // Date utility functions
    function startOfDay(date) {
      const d = new Date(date);
      d.setHours(0, 0, 0, 0);
      return d;
    }

    function formatDate(date, formatStr) {
      const d = new Date(date);
      if (formatStr === 'yyyy-MM-dd') {
        const year = d.getFullYear();
        const month = String(d.getMonth() + 1).padStart(2, '0');
        const day = String(d.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
      }
      if (formatStr === 'MMM d') {
        const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        return `${months[d.getMonth()]} ${d.getDate()}`;
      }
      if (formatStr === 'EEEE, MMMM d, yyyy') {
        const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
        const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
        return `${days[d.getDay()]}, ${months[d.getMonth()]} ${d.getDate()}, ${d.getFullYear()}`;
      }
      if (formatStr === 'MMMM yyyy') {
        const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
        return `${months[d.getMonth()]} ${d.getFullYear()}`;
      }
      return d.toString();
    }

    function subDays(date, days) {
      const result = new Date(date);
      result.setDate(result.getDate() - days);
      return result;
    }

    function getDaysInMonth(year, month) {
      return new Date(year, month + 1, 0).getDate();
    }

    function getFirstDayOfMonth(year, month) {
      return new Date(year, month, 1).getDay();
    }

    // App state
    let habits = {};
    let history = {};
    let customHabits = [];
    let expandedDropdowns = {};
    let showAddForm = false;
    let calendarMonth = new Date().getMonth();
    let calendarYear = new Date().getFullYear();

    // Get daily quote based on day of year
    function getDailyQuote() {
      const now = new Date();
      const start = new Date(now.getFullYear(), 0, 0);
      const diff = now - start;
      const oneDay = 1000 * 60 * 60 * 24;
      const dayOfYear = Math.floor(diff / oneDay);
      return QUOTES[dayOfYear % QUOTES.length];
    }

    // Get all habits (default + custom) - filtered by day of week
    function getAllHabits(date = new Date()) {
      const dayOfWeek = date.getDay(); // 0 = Sunday, 6 = Saturday
      
      // Sunday - rest day, no habits
      if (dayOfWeek === 0) {
        return [];
      }
      
      // Saturday - only exercise and eat healthy
      if (dayOfWeek === 6) {
        const saturdayHabits = DEFAULT_HABITS.filter(h => 
          h.id === 'exercise' || h.id === 'eatHealthy'
        );
        return [...saturdayHabits, ...customHabits.filter(h => h.weekendOnly)];
      }
      
      // Weekdays (Mon-Fri) - all habits
      return [...DEFAULT_HABITS, ...customHabits];
    }
    
    // Get habits for a specific date (used for calendar/history)
    function getHabitsForDate(dateKey) {
      const date = new Date(dateKey);
      return getAllHabits(date);
    }

    // Load data from localStorage
    function loadData() {
      const saved = localStorage.getItem('accountabilityData');
      if (saved) {
        history = JSON.parse(saved);
        const todayKey = formatDate(startOfDay(new Date()), 'yyyy-MM-dd');
        habits = history[todayKey] || {};
      }
      
      const savedHabits = localStorage.getItem('customHabits');
      if (savedHabits) {
        customHabits = JSON.parse(savedHabits);
      }
    }

    // Save data to localStorage
    function saveData() {
      const todayKey = formatDate(startOfDay(new Date()), 'yyyy-MM-dd');
      history[todayKey] = habits;
      localStorage.setItem('accountabilityData', JSON.stringify(history));
    }

    // Save custom habits
    function saveCustomHabits() {
      localStorage.setItem('customHabits', JSON.stringify(customHabits));
    }

    // Add new habit
    function addHabit() {
      const label = document.getElementById('newHabitLabel').value.trim();
      const emoji = document.getElementById('newHabitEmoji').value.trim() || '‚≠ê';
      const hasDropdown = document.getElementById('newHabitDropdown').checked;
      
      if (!label) {
        alert('Please enter a habit name');
        return;
      }
      
      const newHabit = {
        id: 'custom_' + Date.now(),
        label: label,
        emoji: emoji,
        hasDropdown: hasDropdown,
        dropdownTitle: hasDropdown ? `Your ${label}` : null,
        inputLabel: hasDropdown ? label.replace(/[0-9]/g, '').trim() : null,
        isCustom: true
      };
      
      customHabits.push(newHabit);
      saveCustomHabits();
      showAddForm = false;
      render();
    }

    // Delete habit
    function deleteHabit(habitId, event) {
      if (event) event.stopPropagation();
      if (confirm('Are you sure you want to delete this habit?')) {
        customHabits = customHabits.filter(h => h.id !== habitId);
        saveCustomHabits();
        render();
      }
    }

    // Toggle habit
    function toggleHabit(habitId, event) {
      if (event) event.stopPropagation();
      habits[habitId] = !habits[habitId];
      saveData();
      render();
    }

    // Toggle dropdown
    function toggleDropdown(habitId, event) {
      if (event) event.stopPropagation();
      expandedDropdowns[habitId] = !expandedDropdowns[habitId];
      render();
    }

    // Toggle add form
    function toggleAddForm() {
      showAddForm = !showAddForm;
      render();
    }

    // Navigate calendar
    function navigateCalendar(direction) {
      calendarMonth += direction;
      if (calendarMonth > 11) {
        calendarMonth = 0;
        calendarYear++;
      } else if (calendarMonth < 0) {
        calendarMonth = 11;
        calendarYear--;
      }
      render();
    }

    // Update input value
    function updateInput(habitId, index, value) {
      if (!habits[habitId + '_items']) {
        habits[habitId + '_items'] = ['', '', '', '', ''];
      }
      habits[habitId + '_items'][index] = value;
      
      const filledCount = habits[habitId + '_items'].filter(item => item && item.trim() !== '').length;
      habits[habitId] = filledCount >= 5;
      
      saveData();
      updateProgressCircle();
      
      const input = document.querySelector(`[data-input-id="${habitId}-${index}"]`);
      if (input) {
        if (value && value.trim() !== '') {
          input.classList.add('filled');
        } else {
          input.classList.remove('filled');
        }
      }
      
      const filledCountEl = document.querySelector(`[data-filled-count="${habitId}"]`);
      if (filledCountEl) {
        filledCountEl.textContent = `${filledCount}/5`;
      }
      
      const habitItem = document.querySelector(`[data-habit-id="${habitId}"]`);
      const checkbox = habitItem?.querySelector('.habit-checkbox');
      if (habits[habitId]) {
        habitItem?.classList.add('completed');
        if (checkbox) checkbox.innerHTML = `<svg class="checkmark" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12" /></svg>`;
      } else {
        habitItem?.classList.remove('completed');
        if (checkbox) checkbox.innerHTML = '';
      }
    }

    // Update progress circle
    function updateProgressCircle() {
      const allHabits = getAllHabits();
      const completedCount = allHabits.filter(h => habits[h.id]).length;
      const totalHabits = allHabits.length;
      const progress = totalHabits > 0 ? (completedCount / totalHabits) * 100 : 0;
      
      const radius = 70;
      const circumference = 2 * Math.PI * radius;
      const offset = circumference - (progress / 100) * circumference;
      
      const progressFill = document.querySelector('.progress-circle-fill');
      const progressPercentage = document.querySelector('.progress-percentage');
      const completedStat = document.querySelector('.stat-value');
      
      if (progressFill) progressFill.setAttribute('stroke-dashoffset', offset);
      if (progressPercentage) progressPercentage.textContent = Math.round(progress) + '%';
      if (completedStat) completedStat.textContent = completedCount;
    }

    // Calculate progress
    function getProgress() {
      const allHabits = getAllHabits();
      const completedCount = allHabits.filter(h => habits[h.id]).length;
      const totalHabits = allHabits.length;
      return totalHabits > 0 ? (completedCount / totalHabits) * 100 : 0;
    }

    // Get day progress
    function getDayProgress(dateKey) {
      const dayData = history[dateKey] || {};
      const habitsForDay = getHabitsForDate(dateKey);
      
      // Sunday has no habits - show as 100% (rest day complete)
      if (habitsForDay.length === 0) {
        return 100;
      }
      
      const completed = habitsForDay.filter(h => dayData[h.id]).length;
      return habitsForDay.length > 0 ? (completed / habitsForDay.length) * 100 : 0;
    }

    // Get progress level (0-5)
    function getProgressLevel(percentage) {
      if (percentage === 0) return 0;
      if (percentage <= 20) return 1;
      if (percentage <= 40) return 2;
      if (percentage <= 60) return 3;
      if (percentage <= 80) return 4;
      return 5;
    }

    // Calculate stats
    function getStats() {
      // 30-day average
      let totalProgress = 0;
      for (let i = 0; i < 30; i++) {
        const date = subDays(new Date(), i);
        const dateKey = formatDate(startOfDay(date), 'yyyy-MM-dd');
        totalProgress += getDayProgress(dateKey);
      }
      const averageProgress = Math.round(totalProgress / 30);
      
      // Current streak - check each day with its specific habits
      let streak = 0;
      for (let i = 0; i < 365; i++) {
        const date = subDays(new Date(), i);
        const dateKey = formatDate(startOfDay(date), 'yyyy-MM-dd');
        const dayData = history[dateKey] || {};
        const habitsForDay = getHabitsForDate(dateKey);
        
        // Sunday is a rest day - counts as complete
        if (habitsForDay.length === 0) {
          streak++;
          continue;
        }
        
        const habitIds = habitsForDay.map(h => h.id);
        const completed = habitIds.filter(id => dayData[id]).length;
        
        if (completed === habitIds.length && habitIds.length > 0) {
          streak++;
        } else {
          break;
        }
      }
      
      // Best streak
      let bestStreak = 0;
      let currentStreak = 0;
      const sortedDates = Object.keys(history).sort();
      for (const dateKey of sortedDates) {
        const dayData = history[dateKey] || {};
        const habitsForDay = getHabitsForDate(dateKey);
        
        // Sunday is a rest day - counts as complete
        if (habitsForDay.length === 0) {
          currentStreak++;
          bestStreak = Math.max(bestStreak, currentStreak);
          continue;
        }
        
        const habitIds = habitsForDay.map(h => h.id);
        const completed = habitIds.filter(id => dayData[id]).length;
        
        if (completed === habitIds.length && habitIds.length > 0) {
          currentStreak++;
          bestStreak = Math.max(bestStreak, currentStreak);
        } else {
          currentStreak = 0;
        }
      }
      
      return { averageProgress, streak, bestStreak };
    }

    // Render quote
    function renderQuote() {
      const quote = getDailyQuote();
      return `
        <div class="quote-section">
          <p class="quote-text">"${quote.text}"</p>
          <p class="quote-author">‚Äî ${quote.author}</p>
        </div>
      `;
    }

    // Render progress circle
    function renderProgressCircle(progress) {
      const radius = 70;
      const circumference = 2 * Math.PI * radius;
      const offset = circumference - (progress / 100) * circumference;
      const allHabits = getAllHabits();
      const completedCount = allHabits.filter(h => habits[h.id]).length;
      const totalHabits = allHabits.length;

      return `
        <div class="progress-circle-container">
          <svg class="progress-circle" width="170" height="170">
            <circle
              class="progress-circle-bg"
              cx="85"
              cy="85"
              r="${radius}"
              fill="none"
              stroke-width="12"
            />
            <circle
              class="progress-circle-fill"
              cx="85"
              cy="85"
              r="${radius}"
              fill="none"
              stroke-width="12"
              stroke-dasharray="${circumference}"
              stroke-dashoffset="${offset}"
              transform="rotate(-90 85 85)"
            />
          </svg>
          <div class="progress-circle-text">
            <span class="progress-percentage">${Math.round(progress)}%</span>
            <span class="progress-label">Today</span>
          </div>
        </div>
        <div class="progress-stats">
          <div class="stat">
            <span class="stat-value">${completedCount}</span>
            <span class="stat-label">Done</span>
          </div>
          <div class="stat">
            <span class="stat-value">${totalHabits}</span>
            <span class="stat-label">Total</span>
          </div>
        </div>
      `;
    }

    // Render dropdown
    function renderDropdown(habit) {
      const items = habits[habit.id + '_items'] || ['', '', '', '', ''];
      const filledCount = items.filter(item => item && item.trim() !== '').length;
      const isExpanded = expandedDropdowns[habit.id];

      const inputs = items.map((item, index) => {
        const isFilled = item && item.trim() !== '';
        return `
          <div class="input-group">
            <label>${habit.inputLabel} ${index + 1}</label>
            <input 
              type="text" 
              class="input-field ${isFilled ? 'filled' : ''}"
              data-input-id="${habit.id}-${index}"
              value="${item || ''}"
              placeholder="Enter ${habit.inputLabel.toLowerCase()} ${index + 1}..."
              oninput="updateInput('${habit.id}', ${index}, this.value)"
              onclick="event.stopPropagation()"
            />
          </div>
        `;
      }).join('');

      return `
        <div class="dropdown-section ${isExpanded ? 'expanded' : ''}">
          <div class="dropdown-title">
            ${habit.dropdownTitle}
            <span class="filled-count" data-filled-count="${habit.id}">${filledCount}/5</span>
          </div>
          ${inputs}
        </div>
      `;
    }

    // Render add habit form
    function renderAddForm() {
      return `
        <div class="add-habit-form ${showAddForm ? 'visible' : ''}">
          <div class="form-row">
            <input type="text" id="newHabitEmoji" class="form-input emoji-input" placeholder="üìå" maxlength="2" />
            <input type="text" id="newHabitLabel" class="form-input" placeholder="Enter habit name..." />
          </div>
          <label class="form-checkbox">
            <input type="checkbox" id="newHabitDropdown" />
            Add 5 input fields (for lists like ideas, to-dos)
          </label>
          <div class="form-actions">
            <button class="btn btn-primary" onclick="addHabit()">Add Habit</button>
            <button class="btn btn-secondary" onclick="toggleAddForm()">Cancel</button>
          </div>
        </div>
      `;
    }

    // Render habit list
    function renderHabitList() {
      const allHabits = getAllHabits();
      const dayOfWeek = new Date().getDay();
      
      // Sunday - rest day message
      if (dayOfWeek === 0) {
        return `
          <div class="habit-list">
            <div class="habit-list-header">
              <h2 class="habit-list-title">Rest Day</h2>
            </div>
            <div class="rest-day-message">
              <div class="rest-emoji">üò¥</div>
              <h3>It's Sunday!</h3>
              <p>Take a break and recharge. No habits today.</p>
              <p class="rest-subtext">You've earned it!</p>
            </div>
          </div>
        `;
      }
      
      // Saturday - weekend mode message
      let weekendNotice = '';
      if (dayOfWeek === 6) {
        weekendNotice = `
          <div class="weekend-notice">
            <span>üèãÔ∏è</span> Weekend Mode: Exercise & Eat Healthy only
          </div>
        `;
      }
      
      const habitsHtml = allHabits.map(habit => {
        const isCompleted = habits[habit.id] || false;
        const hasDropdown = habit.hasDropdown;
        const isExpanded = expandedDropdowns[habit.id];
        const isCustom = habit.isCustom;
        
        return `
          <div class="habit-wrapper">
            <div class="habit-item ${isCompleted ? 'completed' : ''}" data-habit-id="${habit.id}" onclick="toggleHabit('${habit.id}', event)">
              <div class="habit-checkbox">
                ${isCompleted ? `
                  <svg class="checkmark" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                    <polyline points="20 6 9 17 4 12" />
                  </svg>
                ` : ''}
              </div>
              <div class="habit-content">
                <span class="habit-emoji">${habit.emoji}</span>
                <span class="habit-label">${habit.label}</span>
              </div>
              <div class="habit-actions">
                ${hasDropdown ? `
                  <button class="expand-btn ${isExpanded ? 'expanded' : ''}" onclick="toggleDropdown('${habit.id}', event)">
                    ${isExpanded ? '‚àí' : '+'}
                  </button>
                ` : ''}
                ${isCustom ? `
                  <button class="delete-btn" onclick="deleteHabit('${habit.id}', event)">‚úï</button>
                ` : ''}
              </div>
            </div>
            ${hasDropdown ? renderDropdown(habit) : ''}
          </div>
        `;
      }).join('');

      return `
        <div class="habit-list">
          <div class="habit-list-header">
            <h2 class="habit-list-title">Daily Habits</h2>
            <button class="add-habit-btn" onclick="toggleAddForm()">
              <span>+</span> Add Habit
            </button>
          </div>
          ${weekendNotice}
          ${renderAddForm()}
          <div class="habits-container">
            ${habitsHtml}
          </div>
        </div>
      `;
    }

    // Render calendar
    function renderCalendar() {
      const daysInMonth = getDaysInMonth(calendarYear, calendarMonth);
      const firstDay = getFirstDayOfMonth(calendarYear, calendarMonth);
      const today = new Date();
      const todayKey = formatDate(startOfDay(today), 'yyyy-MM-dd');
      
      const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
      
      let calendarDays = '';
      
      // Empty cells before first day
      for (let i = 0; i < firstDay; i++) {
        calendarDays += '<div class="calendar-day empty"></div>';
      }
      
      // Days of the month
      for (let day = 1; day <= daysInMonth; day++) {
        const date = new Date(calendarYear, calendarMonth, day);
        const dateKey = formatDate(startOfDay(date), 'yyyy-MM-dd');
        const progress = getDayProgress(dateKey);
        const level = getProgressLevel(progress);
        const isToday = dateKey === todayKey;
        
        calendarDays += `
          <div class="calendar-day level-${level} ${isToday ? 'today' : ''}">
            <span class="day-number">${day}</span>
            <span class="day-progress">${Math.round(progress)}%</span>
          </div>
        `;
      }
      
      const stats = getStats();
      
      return `
        <div class="panel-card">
          <div class="calendar-section">
            <div class="calendar-header">
              <h2 class="calendar-title">Monthly Progress</h2>
              <div class="calendar-nav">
                <button class="calendar-nav-btn" onclick="navigateCalendar(-1)">‚Äπ</button>
                <span class="calendar-month-year">${formatDate(new Date(calendarYear, calendarMonth), 'MMMM yyyy')}</span>
                <button class="calendar-nav-btn" onclick="navigateCalendar(1)">‚Ä∫</button>
              </div>
            </div>
            
            <div class="stats-row">
              <div class="stat-card">
                <div class="stat-card-value">${stats.averageProgress}%</div>
                <div class="stat-card-label">30-Day Avg</div>
              </div>
              <div class="stat-card">
                <div class="stat-card-value">${stats.streak}</div>
                <div class="stat-card-label">Current Streak</div>
              </div>
              <div class="stat-card">
                <div class="stat-card-value">${stats.bestStreak}</div>
                <div class="stat-card-label">Best Streak</div>
              </div>
            </div>
            
            <div class="calendar-grid">
              ${dayNames.map(d => `<div class="calendar-day-header">${d}</div>`).join('')}
              ${calendarDays}
            </div>
            
            <div class="calendar-legend">
              <span>Less</span>
              <div class="legend-item level-0"></div>
              <div class="legend-item level-1"></div>
              <div class="legend-item level-2"></div>
              <div class="legend-item level-3"></div>
              <div class="legend-item level-4"></div>
              <div class="legend-item level-5"></div>
              <span>More</span>
            </div>
          </div>
        </div>
      `;
    }

    // Main render function
    function render() {
      const progress = getProgress();
      const today = formatDate(new Date(), 'EEEE, MMMM d, yyyy');

      const html = `
        <div class="app">
          <header class="app-header">
            <h1>Accountability Tracker</h1>
            <p class="date">${today}</p>
          </header>

          ${renderQuote()}

          <div class="app-content">
            <div class="left-panel">
              <div class="progress-section">
                ${renderProgressCircle(progress)}
              </div>
              ${renderHabitList()}
            </div>

            <div class="right-panel">
              ${renderCalendar()}
            </div>
          </div>
        </div>
      `;

      document.getElementById('root').innerHTML = html;
    }

    // Initialize app
    loadData();
    render();

    // Make functions available globally
    window.toggleHabit = toggleHabit;
    window.toggleDropdown = toggleDropdown;
    window.updateInput = updateInput;
    window.toggleAddForm = toggleAddForm;
    window.addHabit = addHabit;
    window.deleteHabit = deleteHabit;
    window.navigateCalendar = navigateCalendar;
  </script>
</body>
</html>
